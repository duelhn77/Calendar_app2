{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 39, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/components/ExportModal.tsx"],"sourcesContent":["import React, { useState } from \"react\";\r\nimport Select from \"react-select\";\r\n\r\ninterface ExportModalProps {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onExport: (startDate: string, endDate: string, format: string) => Promise<boolean>; // 修正箇所: `Promise<boolean>` を返す\r\n}\r\n\r\nconst ExportModal: React.FC<ExportModalProps> = ({ isOpen, onClose, onExport }) => {\r\n  const [startDate, setStartDate] = useState(\"\");\r\n  const [endDate, setEndDate] = useState(\"\");\r\n  const [format, setFormat] = useState(\"xlsx\");\r\n  const [errorMessage, setErrorMessage] = useState(\"\"); // 修正箇所: エラーメッセージ用の state\r\n\r\n  if (!isOpen) return null;\r\n\r\n  const handleExport = async () => {\r\n    setErrorMessage(\"\"); // 修正箇所: エラーメッセージをリセット\r\n\r\n    const success = await onExport(startDate, endDate, format); // 修正箇所: `onExport` の結果を取得\r\n    if (success) {\r\n      onClose(); // 修正箇所: エクスポート成功時にモーダルを閉じる\r\n    } else {\r\n      setErrorMessage(\"対象期間に該当データはありません\"); // 修正箇所: エラー時にメッセージを表示\r\n    }\r\n  };\r\n\r\n  return (\r\n    <>\r\n      {/* ✅ オーバーレイを適用 */}\r\n      <div className=\"export-modal-overlay\" onClick={onClose}></div>\r\n\r\n      {/* ✅ モーダル本体 */}\r\n      <div className=\"export-modal\" onClick={(e) => e.stopPropagation()}>\r\n        <h2>📥 データをエクスポート</h2>\r\n\r\n        <label>開始日</label>\r\n        <input type=\"date\" value={startDate} onChange={(e) => setStartDate(e.target.value)} />\r\n\r\n        <label>終了日</label>\r\n        <input type=\"date\" value={endDate} onChange={(e) => setEndDate(e.target.value)} />\r\n\r\n        <label>ファイル形式</label>\r\n        <Select\r\n          options={[\r\n            { value: \"xlsx\", label: \"Excel (.xlsx)\" },\r\n            { value: \"csv\", label: \"CSV (.csv)\" }\r\n          ]}\r\n          value={{ value: format, label: format === \"xlsx\" ? \"Excel (.xlsx)\" : \"CSV (.csv)\" }}\r\n          onChange={(selectedOption) => setFormat(selectedOption?.value || \"xlsx\")} // 修正箇所: 選択されたフォーマットを反映\r\n        />\r\n\r\n        {/* 修正箇所: エラーメッセージを赤字で表示 */}\r\n        {errorMessage && <p style={{ color: \"red\" }}>{errorMessage}</p>}\r\n\r\n        <div className=\"export-modal-buttons\">\r\n          <button className=\"export-button\" onClick={handleExport}>📤 エクスポート</button>\r\n          <button className=\"export-button cancel\" onClick={onClose}>キャンセル</button>\r\n        </div>\r\n      </div>\r\n    </>\r\n  );\r\n};\r\n\r\nexport default ExportModal;\r\n"],"names":[],"mappings":";;;;AAAA;AACA;;;;AAQA,MAAM,cAA0C,CAAC,EAAE,MAAM,EAAE,OAAO,EAAE,QAAQ,EAAE;IAC5E,MAAM,CAAC,WAAW,aAAa,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAC3C,MAAM,CAAC,SAAS,WAAW,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACvC,MAAM,CAAC,QAAQ,UAAU,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACrC,MAAM,CAAC,cAAc,gBAAgB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE,KAAK,yBAAyB;IAE/E,IAAI,CAAC,QAAQ,OAAO;IAEpB,MAAM,eAAe;QACnB,gBAAgB,KAAK,sBAAsB;QAE3C,MAAM,UAAU,MAAM,SAAS,WAAW,SAAS,SAAS,0BAA0B;QACtF,IAAI,SAAS;YACX,WAAW,2BAA2B;QACxC,OAAO;YACL,gBAAgB,qBAAqB,sBAAsB;QAC7D;IACF;IAEA,qBACE;;0BAEE,8OAAC;gBAAI,WAAU;gBAAuB,SAAS;;;;;;0BAG/C,8OAAC;gBAAI,WAAU;gBAAe,SAAS,CAAC,IAAM,EAAE,eAAe;;kCAC7D,8OAAC;kCAAG;;;;;;kCAEJ,8OAAC;kCAAM;;;;;;kCACP,8OAAC;wBAAM,MAAK;wBAAO,OAAO;wBAAW,UAAU,CAAC,IAAM,aAAa,EAAE,MAAM,CAAC,KAAK;;;;;;kCAEjF,8OAAC;kCAAM;;;;;;kCACP,8OAAC;wBAAM,MAAK;wBAAO,OAAO;wBAAS,UAAU,CAAC,IAAM,WAAW,EAAE,MAAM,CAAC,KAAK;;;;;;kCAE7E,8OAAC;kCAAM;;;;;;kCACP,8OAAC,iLAAA,CAAA,UAAM;wBACL,SAAS;4BACP;gCAAE,OAAO;gCAAQ,OAAO;4BAAgB;4BACxC;gCAAE,OAAO;gCAAO,OAAO;4BAAa;yBACrC;wBACD,OAAO;4BAAE,OAAO;4BAAQ,OAAO,WAAW,SAAS,kBAAkB;wBAAa;wBAClF,UAAU,CAAC,iBAAmB,UAAU,gBAAgB,SAAS;;;;;;oBAIlE,8BAAgB,8OAAC;wBAAE,OAAO;4BAAE,OAAO;wBAAM;kCAAI;;;;;;kCAE9C,8OAAC;wBAAI,WAAU;;0CACb,8OAAC;gCAAO,WAAU;gCAAgB,SAAS;0CAAc;;;;;;0CACzD,8OAAC;gCAAO,WAAU;gCAAuB,SAAS;0CAAS;;;;;;;;;;;;;;;;;;;;AAKrE;uCAEe","debugId":null}},
    {"offset": {"line": 191, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 197, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/components/Sidebar.tsx"],"sourcesContent":["import { useState, useEffect, useRef } from \"react\";\r\nimport { FaCog } from \"react-icons/fa\";\r\nimport { useRouter } from \"next/navigation\";\r\nimport ExportModal from \"./ExportModal\";\r\n\r\nexport type SidebarView = \"calendar\" | \"report\" | \"user-report\" | \"dashboard\" | \"budget\";\r\n\r\ntype SidebarProps = {\r\n  onSelectView: (view: SidebarView) => void;\r\n};\r\n\r\nexport default function Sidebar({ onSelectView }: SidebarProps) {\r\n  const [isMenuOpen, setIsMenuOpen] = useState(false);\r\n  const [isReportOpen, setIsReportOpen] = useState(false);\r\n  const [isExportOpen, setIsExportOpen] = useState(false);\r\n  const [isExportMyDataOpen, setIsExportMyDataOpen] = useState(false);\r\n  const [permissions, setPermissions] = useState({\r\n    canExportAll: false,\r\n    canViewReport: false,\r\n    canViewUserReport: false,\r\n    canViewDashboard: false,\r\n    canManageBudget: false,\r\n  });\r\n  const router = useRouter();\r\n\r\n  const reportRef = useRef<HTMLLIElement | null>(null);\r\n  const menuRef = useRef<HTMLDivElement>(null);\r\n\r\n  useEffect(() => {\r\n    const fetchPermissions = async () => {\r\n      const userId = localStorage.getItem(\"userId\");\r\n      if (!userId) return;\r\n\r\n      try {\r\n        const res = await fetch(`/api/getUserPermissions?userId=${userId}`);\r\n        const data = await res.json();\r\n        console.log(\"✅ 権限データ:\", data);\r\n        setPermissions(data);\r\n      } catch (error) {\r\n        console.error(\"❌ 権限取得エラー:\", error);\r\n      }\r\n    };\r\n\r\n    fetchPermissions();\r\n  }, []);\r\n\r\n  const handleLogout = () => {\r\n    localStorage.removeItem(\"isAuthenticated\");\r\n    router.push(\"/login\");\r\n  };\r\n\r\n  const handleChangePassword = () => {\r\n    router.push(\"/change-password\");\r\n  };\r\n\r\n  const handleExport = async (startDate: string, endDate: string, format: string, userId?: string): Promise<boolean> => {\r\n    try {\r\n      const response = await fetch(\"/api/exportData\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ startDate, endDate, format, userId })\r\n      });\r\n\r\n      if (!response.ok) {\r\n        const errorData = await response.json();\r\n        if (errorData.error === \"対象期間に該当データはありません\") return false;\r\n        throw new Error(\"エクスポート処理に失敗しました\");\r\n      }\r\n\r\n      const blob = await response.blob();\r\n      const downloadUrl = window.URL.createObjectURL(blob);\r\n      const link = document.createElement(\"a\");\r\n      link.href = downloadUrl;\r\n      link.setAttribute(\"download\", `export.${format}`);\r\n      document.body.appendChild(link);\r\n      link.click();\r\n      link.remove();\r\n\r\n      return true;\r\n    } catch (error) {\r\n      console.error(\"❌ エクスポートエラー:\", error);\r\n      return false;\r\n    }\r\n  };\r\n\r\n  useEffect(() => {\r\n    function handleClickOutside(event: MouseEvent) {\r\n      if (reportRef.current && !reportRef.current.contains(event.target as Node)) {\r\n        setIsReportOpen(false);\r\n      }\r\n      if (menuRef.current && !menuRef.current.contains(event.target as Node)) {\r\n        setIsMenuOpen(false);\r\n      }\r\n    }\r\n\r\n    document.addEventListener(\"mousedown\", handleClickOutside);\r\n    return () => {\r\n      document.removeEventListener(\"mousedown\", handleClickOutside);\r\n    };\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"sidebar\">\r\n      <h1 className=\"sidebar-title\">執務管理システム</h1>\r\n      <ul>\r\n      <li className=\"report-item\" onClick={() => onSelectView(\"calendar\")}>\r\n       <span>🗓️ タイムシート</span>\r\n       <span className=\"report-arrow\"></span>\r\n     </li>\r\n        <li onClick={() => setIsReportOpen(!isReportOpen)} ref={reportRef}>\r\n          <span>📑レポート</span>\r\n          <span className=\"report-arrow\">▶</span>\r\n\r\n          {isReportOpen && (\r\n            <div className=\"menu-popup_report\">\r\n              <button\r\n                className=\"export-button\"\r\n                onClick={() => setIsExportMyDataOpen(true)}\r\n              >\r\n                📤 Export（My Data）\r\n              </button>\r\n\r\n              {isExportMyDataOpen && (\r\n                <ExportModal\r\n                  isOpen={isExportMyDataOpen}\r\n                  onClose={() => setIsExportMyDataOpen(false)}\r\n                  onExport={async (startDate, endDate, format) => {\r\n                    const userId = localStorage.getItem(\"userId\") || \"\";\r\n                    return await handleExport(startDate, endDate, format, userId);\r\n                  }}\r\n                />\r\n              )}\r\n\r\n              {(permissions.canExportAll || permissions.canViewReport || permissions.canViewUserReport || permissions.canViewDashboard) && (\r\n                <div>\r\n                  {permissions.canExportAll && (\r\n                    <button\r\n                      className=\"export-button\"\r\n                      onClick={() => setIsExportOpen(true)}\r\n                    >\r\n                      📤 Export（all Data）\r\n                    </button>\r\n                  )}\r\n\r\n                  {permissions.canViewReport && (\r\n                    <button\r\n                      className=\"export-button\"\r\n                      onClick={() => onSelectView(\"report\")}\r\n                    >\r\n                      📊 予実レポート\r\n                    </button>\r\n                  )}\r\n\r\n                  {permissions.canViewUserReport && (\r\n                    <button\r\n                      className=\"export-button\"\r\n                      onClick={() => onSelectView(\"user-report\")}\r\n                    >\r\n                      👤 ユーザー別レポート\r\n                    </button>\r\n                  )}\r\n\r\n                  {permissions.canViewDashboard && (\r\n                    <button\r\n                      className=\"export-button\"\r\n                      onClick={() => onSelectView(\"dashboard\")}\r\n                    >\r\n                      📈 ユーザー月次ダッシュボード\r\n                    </button>\r\n                  )}\r\n                </div>\r\n              )}\r\n            </div>\r\n          )}\r\n        </li>\r\n      </ul>\r\n\r\n      {isExportMyDataOpen && (\r\n        <ExportModal\r\n          isOpen={isExportMyDataOpen}\r\n          onClose={() => setIsExportMyDataOpen(false)}\r\n          onExport={async (startDate, endDate, format) => {\r\n            const userId = localStorage.getItem(\"userId\") || \"\";\r\n            return await handleExport(startDate, endDate, format, userId);\r\n          }}\r\n        />\r\n      )}\r\n\r\n      {isExportOpen && (\r\n        <ExportModal\r\n          isOpen={isExportOpen}\r\n          onClose={() => setIsExportOpen(false)}\r\n          onExport={(startDate, endDate, format) => handleExport(startDate, endDate, format)}\r\n        />\r\n      )}\r\n\r\n      <div\r\n        className=\"settings\"\r\n        onClick={() => setIsMenuOpen(!isMenuOpen)}\r\n        ref={menuRef}\r\n      >\r\n        <FaCog size={20} />\r\n        <span>管理メニュー</span>\r\n        {isMenuOpen && (\r\n          <div className=\"menu-popup\">\r\n            {permissions.canManageBudget && (\r\n             <button\r\n               className=\"budget-button\"\r\n               onClick={() => onSelectView(\"budget\")} // ✅ ルーター遷移ではなく、ビュー切替\r\n             >\r\n              💰 予算管理\r\n             </button>\r\n            )}\r\n            <button className=\"pw-change-button\" onClick={handleChangePassword}>\r\n              🔑 PW変更\r\n            </button>\r\n            <button className=\"logout-button\" onClick={handleLogout}>\r\n              ログアウト\r\n            </button>\r\n          </div>\r\n        )}\r\n        \r\n\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 525, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 531, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/app/budget-report/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\n\r\ntype ReportRow = {\r\n  engagement: string;\r\n  activity: string;\r\n  budget: number;\r\n  actual: number;\r\n  activityId: string;\r\n};\r\n\r\nexport default function BudgetReportPage() {\r\n  const [reportData, setReportData] = useState<ReportRow[]>([]);\r\n  const [selectedEngagement, setSelectedEngagement] = useState<string>(\"\");\r\n  const [engagements, setEngagements] = useState<string[]>([]);\r\n\r\n  useEffect(() => {\r\n    const fetchReportData = async () => {\r\n      const res = await fetch(\"/api/fetchBudgetAndActuals\");\r\n      const data = await res.json();\r\n      setReportData(data);\r\n    };\r\n\r\n    const fetchEngagements = async () => {\r\n      const userId = localStorage.getItem(\"userId\");\r\n      if (!userId) return;\r\n      try {\r\n        const res = await fetch(`/api/fetchEngagements?userId=${userId}`);\r\n        const json = await res.json();\r\n        interface Engagement {\r\n          name: string;\r\n          color: string;\r\n        }\r\n        const names = (json as Engagement[]).map((e) => e.name);\r\n        setEngagements(names);\r\n        // if (names.length > 0) {\r\n        //   setSelectedEngagement(names[0]);\r\n        // }\r\n      } catch (error) {\r\n        console.error(\"❌ fetchEngagements エラー:\", error);\r\n      }\r\n    };\r\n\r\n    fetchReportData();\r\n    fetchEngagements();\r\n  }, []);\r\n\r\n  // ✅ Activityごとに一意にまとめる（予算時間は重複集計しない）\r\n  const activityMap: { [key: string]: ReportRow } = {};\r\n  reportData.forEach((row) => {\r\n    if (row.engagement !== selectedEngagement) return;\r\n    const key = row.activityId + \"_\" + row.activity;\r\n    if (!activityMap[key]) {\r\n      activityMap[key] = { ...row };\r\n    } else {\r\n      activityMap[key].actual += row.actual; // 実績は加算\r\n    }\r\n  });\r\n\r\n  const filteredData = Object.values(activityMap).sort((a, b) => {\r\n    return a.activityId.localeCompare(b.activityId, \"ja\", { numeric: true });\r\n  });\r\n\r\n  const totalBudget = filteredData.reduce((sum, row) => sum + row.budget, 0);\r\n  const totalActual = filteredData.reduce((sum, row) => sum + row.actual, 0);\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-2xl font-bold mb-4\">📊 予実レポート</h1>\r\n\r\n      <div className=\"mb-6\">\r\n        <label\r\n          className=\"mr-3 font-semibold text-gray-700\"\r\n          style={{ fontSize: \"20px\" }}\r\n        >\r\n          Engagement（会社）を選択：\r\n        </label>\r\n        <select\r\n          value={selectedEngagement}\r\n          onChange={(e) => setSelectedEngagement(e.target.value)}\r\n          className=\"border px-3 py-2 rounded-md shadow-sm\"\r\n        >\r\n          <option value=\"\">-- 選択してください --</option>\r\n          {engagements.map((eng) => (\r\n            <option key={eng} value={eng}>\r\n              {eng}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n\r\n      {selectedEngagement && (\r\n        <>\r\n          <h2 className=\"text-xl font-semibold mb-3\" style={{ marginTop: \"35px\" }}>\r\n            「{selectedEngagement}」の予算・実績一覧\r\n          </h2>\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full text-sm border-collapse border\">\r\n              <thead\r\n                style={{\r\n                  borderTop: \"2px solid black\",\r\n                  borderBottom: \"2px solid black\",\r\n                  fontWeight: \"bold\",\r\n                  backgroundColor: \"#aed4f6\",\r\n                }}\r\n              >\r\n                <tr>\r\n                  <th className=\"border px-4 py-2\" style={{ width: \"100px\" }}>Activity ID</th>\r\n                  <th className=\"border px-4 py-2\" style={{ width: \"250px\" }}>Activity</th>\r\n                  <th className=\"border px-4 py-2\" style={{ textAlign: \"right\" }}>予定時間</th>\r\n                  <th className=\"border px-4 py-2\" style={{ textAlign: \"right\" }}>実績時間</th>\r\n                  <th className=\"border px-4 py-2\" style={{ textAlign: \"right\" }}>差分</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredData.map((row, idx) => {\r\n                  const diff = row.actual - row.budget;\r\n                  return (\r\n                    <tr key={idx}>\r\n                      <td className=\"border px-4 py-2 text-center\">{row.activityId}</td>\r\n                      <td className=\"border px-4 py-2 text-center\">{row.activity}</td>\r\n                      <td className=\"border px-4 py-2\" style={{ width: \"120px\", textAlign: \"right\" }}>{row.budget.toFixed(2)} h</td>\r\n                      <td className=\"border px-4 py-2\" style={{ width: \"120px\", textAlign: \"right\" }}>{row.actual.toFixed(2)} h</td>\r\n                      <td\r\n                        className=\"border px-4 py-2 font-bold\"\r\n                        style={{\r\n                          width: \"120px\",\r\n                          textAlign: \"right\",\r\n                          color: diff > 0 ? \"red\" : diff < 0 ? \"green\" : \"black\",\r\n                        }}\r\n                      >\r\n                        {(diff >= 0 ? \"+\" : \"\") + diff.toFixed(2)} h\r\n                      </td>\r\n                    </tr>\r\n                  );\r\n                })}\r\n\r\n                {/* ✅ 合計行 */}\r\n                <tr className=\"bg-gray-100 font-semibold\" \r\n                style={{\r\n                  borderTop: \"2px solid black\",\r\n                  borderBottom: \"2px solid black\",\r\n                  fontWeight: \"bold\",\r\n                  backgroundColor: \"#aed4f6\",\r\n                }}>\r\n                  <td className=\"border px-4 py-2\"></td>\r\n                  <td className=\"border px-4 py-2 text-center\">合計</td>\r\n                  <td className=\"border px-4 py-2\" style={{ textAlign: \"right\" }}>{totalBudget.toFixed(2)} h</td>\r\n                  <td className=\"border px-4 py-2\" style={{ textAlign: \"right\" }}>{totalActual.toFixed(2)} h</td>\r\n                  <td\r\n                    className=\"border px-4 py-2\"\r\n                    style={{\r\n                      textAlign: \"right\",\r\n                      color:\r\n                        totalActual - totalBudget > 0\r\n                          ? \"red\"\r\n                          : totalActual - totalBudget < 0\r\n                          ? \"green\"\r\n                          : \"black\",\r\n                    }}\r\n                  >\r\n                    {(totalActual - totalBudget >= 0 ? \"+\" : \"\") + (totalActual - totalBudget).toFixed(2)} h\r\n                  </td>\r\n                </tr>\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 916, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 922, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/app/user-report/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\n\r\ninterface ReportRow {\r\n  userId: string;\r\n  userName: string;\r\n  engagement: string;\r\n  activity: string;\r\n  activityId?: string;\r\n  budget: number;\r\n  actual: number;\r\n  month?: string;\r\n}\r\n\r\nexport default function UserReportPage() {\r\n  const [data, setData] = useState<ReportRow[]>([]);\r\n  const [engagements, setEngagements] = useState<string[]>([]);\r\n  const [selectedEngagement, setSelectedEngagement] = useState<string>(\"\");\r\n  const [selectedUser, setSelectedUser] = useState<string>(\"\");\r\n  const [viewMode, setViewMode] = useState<\"activity\" | \"month\">(\"activity\");\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      const res = await fetch(\"/api/fetchUserBudgetActuals\");\r\n      if (res.ok) {\r\n        const json = await res.json();\r\n        setData(json);\r\n      }\r\n    };\r\n\r\n    const fetchUserEngagements = async () => {\r\n      const userId = localStorage.getItem(\"userId\");\r\n      if (!userId) return;\r\n\r\n      try {\r\n        const res = await fetch(`/api/fetchEngagements?userId=${userId}`);\r\n        const data = await res.json();\r\n        const engagementNames = Array.isArray(data) \r\n         ? (data as { name: string; color: string }[]).map((e) => e.name) \r\n         : [];\r\n        setEngagements(engagementNames);\r\n      } catch (error) {\r\n        console.error(\"❌ Engagement取得エラー:\", error);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n    fetchUserEngagements();\r\n  }, []);\r\n\r\n  const filteredUsers = Array.from(\r\n    new Set(\r\n      data\r\n        .filter(row => !selectedEngagement || row.engagement === selectedEngagement)\r\n        .map(d => d.userName)\r\n    )\r\n  );\r\n\r\n  const filteredData = selectedEngagement\r\n    ? data.filter(row => {\r\n        const matchEngagement = row.engagement === selectedEngagement;\r\n        const matchUser = selectedUser ? row.userName === selectedUser : true;\r\n        return matchEngagement && matchUser;\r\n      })\r\n    : [];\r\n\r\n  const groupedData = viewMode === \"month\"\r\n    ? Object.values(\r\n        filteredData.reduce((acc, row) => {\r\n          const key = `${row.userName}_${row.engagement}_${row.month}`;\r\n          if (!acc[key]) {\r\n            acc[key] = { ...row, activity: row.month || \"\", budget: 0, actual: 0 };\r\n          }\r\n          acc[key].budget += row.budget;\r\n          acc[key].actual += row.actual;\r\n          return acc;\r\n        }, {} as { [key: string]: ReportRow })\r\n      )\r\n    : Object.values(\r\n        filteredData.reduce((acc, row) => {\r\n          const key = `${row.userName}_${row.engagement}_${row.activityId}_${row.activity}`;\r\n          if (!acc[key]) {\r\n            acc[key] = { ...row, budget: 0, actual: 0 };\r\n          }\r\n          acc[key].budget += row.budget;\r\n          acc[key].actual += row.actual;\r\n          return acc;\r\n        }, {} as { [key: string]: ReportRow })\r\n      ).sort((a, b) => (a.activityId || \"\").localeCompare(b.activityId || \"\", \"ja\", { numeric: true }));\r\n\r\n  const totalActual = groupedData.reduce((sum, row) => sum + row.actual, 0);\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h1 className=\"text-2xl font-bold mb-8\">👤 ユーザー別実績レポート</h1>\r\n\r\n      <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6 mb-10 max-w-4xl\">\r\n        <div className=\"flex flex-col\">\r\n          <label className=\"mb-2 font-semibold\" style={{ fontSize: \"20px\" }}>表示モード：</label>\r\n          <select\r\n            value={viewMode}\r\n            onChange={(e) => setViewMode(e.target.value as \"activity\" | \"month\")}\r\n            className=\"border px-3 py-2 rounded-md shadow-sm\"\r\n          >\r\n            <option value=\"activity\">アクティビティ別</option>\r\n            <option value=\"month\">月別</option>\r\n          </select>\r\n        </div>\r\n\r\n        <div className=\"flex flex-col\">\r\n          <label className=\"mb-2 font-semibold\" style={{ fontSize: \"20px\" }}>Engagement（会社）を選択：</label>\r\n          <select\r\n            value={selectedEngagement}\r\n            onChange={(e) => {\r\n              setSelectedEngagement(e.target.value);\r\n              setSelectedUser(\"\");\r\n            }}\r\n            className=\"border px-3 py-2 rounded-md shadow-sm\"\r\n          >\r\n            <option value=\"\">-- 選択してください --</option>\r\n            {engagements.map((e) => (\r\n              <option key={e} value={e}>{e}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n\r\n        <div className=\"flex flex-col\">\r\n          <label className=\"mb-2 font-semibold\" style={{ fontSize: \"20px\" }}>Userを選択：</label>\r\n          <select\r\n            value={selectedUser}\r\n            onChange={(e) => setSelectedUser(e.target.value)}\r\n            className=\"border px-3 py-2 rounded-md shadow-sm\"\r\n          >\r\n            <option value=\"\">-- 選択してください --</option>\r\n            {filteredUsers.map((u) => (\r\n              <option key={u} value={u}>{u}</option>\r\n            ))}\r\n          </select>\r\n        </div>\r\n      </div>\r\n\r\n      {selectedEngagement && (\r\n        <div className=\"overflow-x-auto\" style={{ marginTop: \"30px\" }}>\r\n          <table className=\"min-w-full text-sm border-collapse border table-auto\">\r\n            <thead style={{ borderTop: \"2px solid black\", borderBottom: \"2px solid black\", fontWeight: \"bold\", backgroundColor: \"#aed4f6\" }}>\r\n              <tr>\r\n                <th className=\"border px-6 py-3\">ユーザー</th>\r\n                <th className=\"border px-6 py-3\">Engagement</th>\r\n                {viewMode === \"activity\" && <th className=\"border px-6 py-3\">Activity ID</th>}\r\n                <th className=\"border px-6 py-3\">{viewMode === \"month\" ? \"月\" : \"Activity\"}</th>\r\n                <th className=\"border px-6 py-3\" style={{ width: \"120px\", textAlign: \"right\" }}>実績</th>\r\n              </tr>\r\n            </thead>\r\n            <tbody>\r\n              {groupedData.map((row, idx) => (\r\n                <tr key={idx} className=\"align-top\">\r\n                  <td className=\"border px-6 py-2\">{row.userName}</td>\r\n                  <td className=\"border px-6 py-2\">{row.engagement}</td>\r\n                  {viewMode === \"activity\" && <td className=\"border px-6 py-2\">{row.activityId}</td>}\r\n                  <td className=\"border px-6 py-2\">{viewMode === \"month\" ? row.month : row.activity}</td>\r\n                  <td className=\"border px-6 py-2\" style={{ width: \"120px\", textAlign: \"right\" }}>{row.actual.toFixed(1)}h</td>\r\n                </tr>\r\n              ))}\r\n\r\n              <tr className=\"font-bold bg-gray-50\" style={{ borderTop: \"2px solid black\", borderBottom: \"2px solid black\", fontWeight: \"bold\", backgroundColor: \"#aed4f6\" }}>\r\n                <td className=\"border px-6 py-2 text-center\" colSpan={viewMode === \"month\" ? 3 : 4}>合計</td>\r\n                <td className=\"border px-6 py-2\" style={{ textAlign: \"right\" }}>{totalActual.toFixed(1)}h</td>\r\n              </tr>\r\n            </tbody>\r\n          </table>\r\n        </div>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1350, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1356, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/app/user-monthly-dashboard/page.tsx"],"sourcesContent":["// src/app/user-monthly-dashboard/page.tsx\r\n\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport {\r\n  BarChart, Bar, XAxis, YAxis, CartesianGrid, Tooltip, Legend,\r\n  ResponsiveContainer,\r\n} from \"recharts\";\r\n\r\ninterface MonthlyRow {\r\n  userName: string;\r\n  month: string;\r\n  totalHours: number;\r\n}\r\n\r\nexport default function UserMonthlyDashboard() {\r\n  const [data, setData] = useState<MonthlyRow[]>([]);\r\n  const [selectedUser, setSelectedUser] = useState<string>(\"\");\r\n\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      const res = await fetch(\"/api/userMonthlySummary\");\r\n      if (res.ok) {\r\n        const json = await res.json();\r\n        setData(json);\r\n      }\r\n    };\r\n    fetchData();\r\n  }, []);\r\n\r\n  const users = Array.from(new Set(data.map((d) => d.userName)));\r\n\r\n  const filteredData = selectedUser\r\n    ? data.filter((d) => d.userName === selectedUser)\r\n    : [];\r\n\r\n  return (\r\n    <div className=\"p-6 space-y-8\">\r\n      <h1 className=\"text-2xl font-bold\">📊 ユーザー別・月別ダッシュボード</h1>\r\n\r\n      <div className=\"mb-4\">\r\n        <label \r\n          className=\"mr-2 font-semibold\"\r\n          style={{ fontSize: \"20px\" }}\r\n        >ユーザー選択：</label>\r\n        <select\r\n          className=\"border p-2 rounded\"\r\n          value={selectedUser}\r\n          onChange={(e) => setSelectedUser(e.target.value)}\r\n        >\r\n          <option value=\"\">-- 選択してください --</option>\r\n          {users.map((user) => (\r\n            <option key={user} value={user}>{user}</option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n\r\n      {selectedUser && (\r\n        <>\r\n          {/* 📊 グラフ表示 */}\r\n          <div style={{ width: \"100%\", height: 350 , marginTop: \"30px\" }}>\r\n            <ResponsiveContainer>\r\n              <BarChart\r\n                data={filteredData}\r\n                margin={{ top: 20, right: 30, left: 20, bottom: 5 }}\r\n              >\r\n                <CartesianGrid strokeDasharray=\"3 3\" />\r\n                <XAxis dataKey=\"month\" />\r\n                <YAxis />\r\n                <Tooltip />\r\n                <Legend />\r\n                <Bar dataKey=\"totalHours\" fill=\"#8884d8\" name=\"実績時間 (h)\" />\r\n              </BarChart>\r\n            </ResponsiveContainer>\r\n          </div>\r\n\r\n          {/* 📋 テーブル表示 */}\r\n          <div className=\"overflow-x-auto\">\r\n            <table className=\"min-w-full border text-sm\">\r\n              <thead className=\"bg-gray-100\">\r\n                <tr>\r\n                  <th className=\"border px-4 py-2\"style={{ width: \"120px\", textAlign: \"right\" }}>ユーザー</th>\r\n                  <th className=\"border px-4 py-2\"style={{ width: \"120px\", textAlign: \"right\" }}>月</th>\r\n                  <th className=\"border px-4 py-2\"style={{ width: \"120px\", textAlign: \"right\" }}>実績時間</th>\r\n                </tr>\r\n              </thead>\r\n              <tbody>\r\n                {filteredData.map((row, idx) => (\r\n                  <tr key={idx} className=\"text-center\">\r\n                    <td className=\"border px-4 py-2\"style={{ width: \"120px\", textAlign: \"right\" }}>{row.userName}</td>\r\n                    <td className=\"border px-4 py-2\"style={{ width: \"120px\", textAlign: \"right\" }}>{row.month}</td>\r\n                    <td className=\"border px-4 py-2\"style={{ width: \"120px\", textAlign: \"right\" }}>{row.totalHours.toFixed(1)} h</td>\r\n                  </tr>\r\n                ))}\r\n              </tbody>\r\n            </table>\r\n          </div>\r\n        </>\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":"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","debugId":null}},
    {"offset": {"line": 1649, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1655, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/components/ConfirmModal.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport React from \"react\";\r\n\r\ntype ConfirmModalProps = {\r\n  isOpen: boolean;\r\n  onClose: () => void;\r\n  onConfirm: () => void;\r\n  message?: string;\r\n};\r\n\r\nexport default function ConfirmModal({\r\n  isOpen,\r\n  onClose,\r\n  onConfirm,\r\n  message = \"この操作を実行してもよろしいですか？\",\r\n}: ConfirmModalProps) {\r\n  if (!isOpen) return null;\r\n\r\n  return (\r\n    <div\r\n      className=\"fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50\"\r\n      onClick={onClose}\r\n    >\r\n      <div\r\n        className=\"bg-white rounded-lg shadow-lg p-6 w-96\"\r\n        onClick={(e) => e.stopPropagation()}\r\n      >\r\n        <h3 className=\"text-lg font-semibold mb-4 text-gray-800\">{message}</h3>\r\n        <div className=\"flex justify-end gap-3\">\r\n          <button\r\n            className=\"bg-gray-300 hover:bg-gray-400 text-gray-800 px-4 py-2 rounded\"\r\n            onClick={onClose}\r\n          >\r\n            キャンセル\r\n          </button>\r\n          <button\r\n            className=\"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded\"\r\n            onClick={() => {\r\n              onConfirm();\r\n              onClose();\r\n            }}\r\n          >\r\n            更新を確定する\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAAA;;AAWe,SAAS,aAAa,EACnC,MAAM,EACN,OAAO,EACP,SAAS,EACT,UAAU,oBAAoB,EACZ;IAClB,IAAI,CAAC,QAAQ,OAAO;IAEpB,qBACE,8OAAC;QACC,WAAU;QACV,SAAS;kBAET,cAAA,8OAAC;YACC,WAAU;YACV,SAAS,CAAC,IAAM,EAAE,eAAe;;8BAEjC,8OAAC;oBAAG,WAAU;8BAA4C;;;;;;8BAC1D,8OAAC;oBAAI,WAAU;;sCACb,8OAAC;4BACC,WAAU;4BACV,SAAS;sCACV;;;;;;sCAGD,8OAAC;4BACC,WAAU;4BACV,SAAS;gCACP;gCACA;4BACF;sCACD;;;;;;;;;;;;;;;;;;;;;;;AAOX","debugId":null}},
    {"offset": {"line": 1720, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1726, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/components/BudgetEditor.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useEffect, useState } from \"react\";\r\nimport ConfirmModal from \"./ConfirmModal\"; // 別途作成が必要\r\n\r\ntype ActivityRow = {\r\n  activityId: string;\r\n  activityName: string;\r\n  budget: number;\r\n};\r\n\r\ntype Props = {\r\n  engagement: string;\r\n};\r\n\r\nexport default function BudgetEditor({ engagement }: Props) {\r\n  const [activities, setActivities] = useState<ActivityRow[]>([]);\r\n  const [editedBudgets, setEditedBudgets] = useState<Record<string, string>>({});\r\n  const [selectedActivity, setSelectedActivity] = useState<string | null>(null);\r\n  const [isModalOpen, setIsModalOpen] = useState(false);\r\n\r\n  // 1. データ取得\r\n  useEffect(() => {\r\n    const fetchData = async () => {\r\n      try {\r\n        const res = await fetch(\"/api/fetchBudgetAndActuals\");\r\n        const allData = await res.json();\r\n\r\n        const filtered = allData\r\n          .filter((d: any) => d.engagement === engagement)\r\n          .reduce((map: Record<string, ActivityRow>, row: any) => {\r\n            if (!map[row.activityId]) {\r\n              map[row.activityId] = {\r\n                activityId: row.activityId,\r\n                activityName: row.activity,\r\n                budget: row.budget,\r\n              };\r\n            }\r\n            return map;\r\n          }, {});\r\n\r\n          const activityList = Object.values(filtered).sort((a, b) =>\r\n            (a as ActivityRow).activityId.localeCompare((b as ActivityRow).activityId)\r\n          ) as ActivityRow[];\r\n          setActivities(activityList); // ✅ 型エラー解消\r\n          \r\n      } catch (err) {\r\n        console.error(\"❌ データ取得エラー:\", err);\r\n      }\r\n    };\r\n\r\n    fetchData();\r\n  }, [engagement]);\r\n\r\n  // 2. 入力値更新\r\n  const handleChange = (activityId: string, value: string) => {\r\n    setEditedBudgets({ ...editedBudgets, [activityId]: value });\r\n  };\r\n\r\n  // 3. モーダル表示\r\n  const handleUpdate = (activityId: string) => {\r\n    setSelectedActivity(activityId);\r\n    setIsModalOpen(true);\r\n  };\r\n\r\n  // 4. 実際の更新処理\r\n  const confirmUpdate = async () => {\r\n    if (!selectedActivity) return;\r\n\r\n    const newBudget = editedBudgets[selectedActivity];\r\n    if (newBudget === undefined || isNaN(Number(newBudget))) {\r\n      alert(\"数値を入力してください\");\r\n      return;\r\n    }\r\n\r\n    try {\r\n      const res = await fetch(\"/api/updateBudget\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({\r\n          engagement,\r\n          activityId: selectedActivity,\r\n          newBudget: Number(newBudget),\r\n        }),\r\n      });\r\n\r\n      if (!res.ok) throw new Error(\"更新に失敗しました\");\r\n\r\n      // 更新後再取得\r\n      const updatedList = activities.map((act) =>\r\n        act.activityId === selectedActivity\r\n          ? { ...act, budget: Number(newBudget) }\r\n          : act\r\n      );\r\n      setActivities(updatedList);\r\n      setIsModalOpen(false);\r\n      alert(\"✅ 更新しました\");\r\n    } catch (error) {\r\n      console.error(\"❌ 更新失敗:\", error);\r\n      alert(\"更新に失敗しました\");\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"border p-4 rounded shadow bg-white\">\r\n      <h3 className=\"text-lg font-semibold mb-4\">活動別予算編集：{engagement}</h3>\r\n\r\n      <table className=\"w-full border-collapse\">\r\n        <thead>\r\n          <tr className=\"bg-gray-100\">\r\n            <th className=\"border p-2\">Activity ID</th>\r\n            <th className=\"border p-2\">Activity名</th>\r\n            <th className=\"border p-2\">予算（h）</th>\r\n            <th className=\"border p-2\">操作</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {activities.map((act) => (\r\n            <tr key={act.activityId}>\r\n              <td className=\"border p-2\">{act.activityId}</td>\r\n              <td className=\"border p-2\">{act.activityName}</td>\r\n              <td className=\"border p-2\">\r\n                <input\r\n                  type=\"number\"\r\n                  value={editedBudgets[act.activityId] ?? act.budget.toString()}\r\n                  onChange={(e) => handleChange(act.activityId, e.target.value)}\r\n                  className=\"border px-2 py-1 w-24\"\r\n                />\r\n              </td>\r\n              <td className=\"border p-2\">\r\n                <button\r\n                  onClick={() => handleUpdate(act.activityId)}\r\n                  className=\"bg-blue-500 hover:bg-blue-600 text-white px-3 py-1 rounded\"\r\n                >\r\n                  更新\r\n                </button>\r\n              </td>\r\n            </tr>\r\n          ))}\r\n        </tbody>\r\n      </table>\r\n\r\n      <ConfirmModal\r\n        isOpen={isModalOpen}\r\n        onClose={() => setIsModalOpen(false)}\r\n        onConfirm={confirmUpdate}\r\n        message=\"予算を更新してよろしいですか？\"\r\n      />\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA,sOAA2C,UAAU;AAHrD;;;;AAee,SAAS,aAAa,EAAE,UAAU,EAAS;IACxD,MAAM,CAAC,YAAY,cAAc,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB,EAAE;IAC9D,MAAM,CAAC,eAAe,iBAAiB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAA0B,CAAC;IAC5E,MAAM,CAAC,kBAAkB,oBAAoB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAiB;IACxE,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IAE/C,WAAW;IACX,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,YAAY;YAChB,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM;gBACxB,MAAM,UAAU,MAAM,IAAI,IAAI;gBAE9B,MAAM,WAAW,QACd,MAAM,CAAC,CAAC,IAAW,EAAE,UAAU,KAAK,YACpC,MAAM,CAAC,CAAC,KAAkC;oBACzC,IAAI,CAAC,GAAG,CAAC,IAAI,UAAU,CAAC,EAAE;wBACxB,GAAG,CAAC,IAAI,UAAU,CAAC,GAAG;4BACpB,YAAY,IAAI,UAAU;4BAC1B,cAAc,IAAI,QAAQ;4BAC1B,QAAQ,IAAI,MAAM;wBACpB;oBACF;oBACA,OAAO;gBACT,GAAG,CAAC;gBAEJ,MAAM,eAAe,OAAO,MAAM,CAAC,UAAU,IAAI,CAAC,CAAC,GAAG,IACpD,AAAC,EAAkB,UAAU,CAAC,aAAa,CAAC,AAAC,EAAkB,UAAU;gBAE3E,cAAc,eAAe,WAAW;YAE5C,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,eAAe;YAC/B;QACF;QAEA;IACF,GAAG;QAAC;KAAW;IAEf,WAAW;IACX,MAAM,eAAe,CAAC,YAAoB;QACxC,iBAAiB;YAAE,GAAG,aAAa;YAAE,CAAC,WAAW,EAAE;QAAM;IAC3D;IAEA,YAAY;IACZ,MAAM,eAAe,CAAC;QACpB,oBAAoB;QACpB,eAAe;IACjB;IAEA,aAAa;IACb,MAAM,gBAAgB;QACpB,IAAI,CAAC,kBAAkB;QAEvB,MAAM,YAAY,aAAa,CAAC,iBAAiB;QACjD,IAAI,cAAc,aAAa,MAAM,OAAO,aAAa;YACvD,MAAM;YACN;QACF;QAEA,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,qBAAqB;gBAC3C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBACnB;oBACA,YAAY;oBACZ,WAAW,OAAO;gBACpB;YACF;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE,MAAM,IAAI,MAAM;YAE7B,SAAS;YACT,MAAM,cAAc,WAAW,GAAG,CAAC,CAAC,MAClC,IAAI,UAAU,KAAK,mBACf;oBAAE,GAAG,GAAG;oBAAE,QAAQ,OAAO;gBAAW,IACpC;YAEN,cAAc;YACd,eAAe;YACf,MAAM;QACR,EAAE,OAAO,OAAO;YACd,QAAQ,KAAK,CAAC,WAAW;YACzB,MAAM;QACR;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;;oBAA6B;oBAAS;;;;;;;0BAEpD,8OAAC;gBAAM,WAAU;;kCACf,8OAAC;kCACC,cAAA,8OAAC;4BAAG,WAAU;;8CACZ,8OAAC;oCAAG,WAAU;8CAAa;;;;;;8CAC3B,8OAAC;oCAAG,WAAU;8CAAa;;;;;;8CAC3B,8OAAC;oCAAG,WAAU;8CAAa;;;;;;8CAC3B,8OAAC;oCAAG,WAAU;8CAAa;;;;;;;;;;;;;;;;;kCAG/B,8OAAC;kCACE,WAAW,GAAG,CAAC,CAAC,oBACf,8OAAC;;kDACC,8OAAC;wCAAG,WAAU;kDAAc,IAAI,UAAU;;;;;;kDAC1C,8OAAC;wCAAG,WAAU;kDAAc,IAAI,YAAY;;;;;;kDAC5C,8OAAC;wCAAG,WAAU;kDACZ,cAAA,8OAAC;4CACC,MAAK;4CACL,OAAO,aAAa,CAAC,IAAI,UAAU,CAAC,IAAI,IAAI,MAAM,CAAC,QAAQ;4CAC3D,UAAU,CAAC,IAAM,aAAa,IAAI,UAAU,EAAE,EAAE,MAAM,CAAC,KAAK;4CAC5D,WAAU;;;;;;;;;;;kDAGd,8OAAC;wCAAG,WAAU;kDACZ,cAAA,8OAAC;4CACC,SAAS,IAAM,aAAa,IAAI,UAAU;4CAC1C,WAAU;sDACX;;;;;;;;;;;;+BAfI,IAAI,UAAU;;;;;;;;;;;;;;;;0BAwB7B,8OAAC,kIAAA,CAAA,UAAY;gBACX,QAAQ;gBACR,SAAS,IAAM,eAAe;gBAC9B,WAAW;gBACX,SAAQ;;;;;;;;;;;;AAIhB","debugId":null}},
    {"offset": {"line": 1963, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 1969, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/components/BudgetManagement.tsx"],"sourcesContent":["\"use client\";\r\nimport { useEffect, useState } from \"react\";\r\nimport BudgetEditor from \"@/components/BudgetEditor\";\r\n\r\nexport default function BudgetManagement() {\r\n  const [engagements, setEngagements] = useState<string[]>([]);\r\n  const [selectedEngagement, setSelectedEngagement] = useState<string>(\"\");\r\n\r\n  useEffect(() => {\r\n    const fetchEngagements = async () => {\r\n      try {\r\n        const res = await fetch(\"/api/fetchEngagements\");\r\n        const data = await res.json();\r\n        const names = data.map((item: any) => item.name || item.Engagement名); // ←列名によって調整\r\n        setEngagements(names);\r\n      } catch (err) {\r\n        console.error(\"❌ Engagement取得エラー:\", err);\r\n      }\r\n    };\r\n    fetchEngagements();\r\n  }, []);\r\n\r\n  return (\r\n    <div className=\"p-6\">\r\n      <h2 className=\"text-xl font-bold mb-4\">💰 予算管理</h2>\r\n      <div className=\"mb-4\">\r\n        <label className=\"block mb-2\">Engagement を選択：</label>\r\n        <select\r\n          onChange={(e) => setSelectedEngagement(e.target.value)}\r\n          className=\"border p-2 rounded\"\r\n        >\r\n          <option value=\"\">-- 選択してください --</option>\r\n          {engagements.map((e) => (\r\n            <option key={e} value={e}>\r\n              {e}\r\n            </option>\r\n          ))}\r\n        </select>\r\n      </div>\r\n\r\n      {selectedEngagement && (\r\n        <BudgetEditor engagement={selectedEngagement} />\r\n      )}\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AAFA;;;;AAIe,SAAS;IACtB,MAAM,CAAC,aAAa,eAAe,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAY,EAAE;IAC3D,MAAM,CAAC,oBAAoB,sBAAsB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAU;IAErE,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,mBAAmB;YACvB,IAAI;gBACF,MAAM,MAAM,MAAM,MAAM;gBACxB,MAAM,OAAO,MAAM,IAAI,IAAI;gBAC3B,MAAM,QAAQ,KAAK,GAAG,CAAC,CAAC,OAAc,KAAK,IAAI,IAAI,KAAK,WAAW,GAAG,YAAY;gBAClF,eAAe;YACjB,EAAE,OAAO,KAAK;gBACZ,QAAQ,KAAK,CAAC,sBAAsB;YACtC;QACF;QACA;IACF,GAAG,EAAE;IAEL,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;gBAAG,WAAU;0BAAyB;;;;;;0BACvC,8OAAC;gBAAI,WAAU;;kCACb,8OAAC;wBAAM,WAAU;kCAAa;;;;;;kCAC9B,8OAAC;wBACC,UAAU,CAAC,IAAM,sBAAsB,EAAE,MAAM,CAAC,KAAK;wBACrD,WAAU;;0CAEV,8OAAC;gCAAO,OAAM;0CAAG;;;;;;4BAChB,YAAY,GAAG,CAAC,CAAC,kBAChB,8OAAC;oCAAe,OAAO;8CACpB;mCADU;;;;;;;;;;;;;;;;;YAOlB,oCACC,8OAAC,kIAAA,CAAA,UAAY;gBAAC,YAAY;;;;;;;;;;;;AAIlC","debugId":null}},
    {"offset": {"line": 2063, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2069, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/app/login/page.tsx"],"sourcesContent":["\"use client\";\r\nimport { useState } from \"react\";\r\nimport { useRouter } from \"next/navigation\";\r\n\r\nexport default function Login() {\r\n  const [email, setEmail] = useState(\"\");\r\n  const [password, setPassword] = useState(\"\");\r\n  const [error, setError] = useState(\"\");\r\n  const router = useRouter();\r\n\r\n  // ✅ ログイン処理\r\n  const handleLogin = async () => {\r\n    setError(\"\"); // ✅ エラーをリセット\r\n\r\n    try {\r\n      const res = await fetch(\"/api/authenticateUser\", {\r\n        method: \"POST\",\r\n        headers: { \"Content-Type\": \"application/json\" },\r\n        body: JSON.stringify({ email, password }),\r\n      });\r\n\r\n      if (!res.ok) {\r\n        throw new Error(\"ログインに失敗しました。\");\r\n      }\r\n\r\n      const data = await res.json();\r\n      localStorage.setItem(\"isAuthenticated\", \"true\");\r\n      localStorage.setItem(\"userId\", data.userId);\r\n\r\n      console.log(\"✅ ログイン成功: カレンダーに遷移\");\r\n      router.push(\"/calendar\"); // ✅ ログイン後にカレンダーに遷移\r\n\r\n    } catch (error) {\r\n      setError((error as Error).message);\r\n      console.error(\"❌ ログインエラー:\", error);\r\n    }\r\n  };\r\n  \r\n\r\n  // ✅ Enterキーでログインできるようにする\r\n  const handleKeyDown = (e: React.KeyboardEvent<HTMLInputElement>) => {\r\n    if (e.key === \"Enter\") {\r\n      handleLogin();\r\n    }\r\n  };\r\n\r\n  return (\r\n    <div className=\"login-container\">\r\n      <h2>ログイン</h2>\r\n      {error && <p className=\"error\">{error}</p>}\r\n      <input\r\n        type=\"email\"\r\n        placeholder=\"メールアドレス\"\r\n        value={email}\r\n        onChange={(e) => setEmail(e.target.value)}\r\n        onKeyDown={handleKeyDown} // ✅ エンターキー対応\r\n      />\r\n      <input\r\n        type=\"password\"\r\n        placeholder=\"パスワード\"\r\n        value={password}\r\n        onChange={(e) => setPassword(e.target.value)}\r\n        onKeyDown={handleKeyDown} // ✅ エンターキー対応\r\n      />\r\n      <button onClick={handleLogin}>ログイン</button>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AACA;AACA;AAFA;;;;AAIe,SAAS;IACtB,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,CAAC,UAAU,YAAY,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACzC,MAAM,CAAC,OAAO,SAAS,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAE;IACnC,MAAM,SAAS,CAAA,GAAA,kIAAA,CAAA,YAAS,AAAD;IAEvB,WAAW;IACX,MAAM,cAAc;QAClB,SAAS,KAAK,aAAa;QAE3B,IAAI;YACF,MAAM,MAAM,MAAM,MAAM,yBAAyB;gBAC/C,QAAQ;gBACR,SAAS;oBAAE,gBAAgB;gBAAmB;gBAC9C,MAAM,KAAK,SAAS,CAAC;oBAAE;oBAAO;gBAAS;YACzC;YAEA,IAAI,CAAC,IAAI,EAAE,EAAE;gBACX,MAAM,IAAI,MAAM;YAClB;YAEA,MAAM,OAAO,MAAM,IAAI,IAAI;YAC3B,aAAa,OAAO,CAAC,mBAAmB;YACxC,aAAa,OAAO,CAAC,UAAU,KAAK,MAAM;YAE1C,QAAQ,GAAG,CAAC;YACZ,OAAO,IAAI,CAAC,cAAc,mBAAmB;QAE/C,EAAE,OAAO,OAAO;YACd,SAAS,AAAC,MAAgB,OAAO;YACjC,QAAQ,KAAK,CAAC,cAAc;QAC9B;IACF;IAGA,yBAAyB;IACzB,MAAM,gBAAgB,CAAC;QACrB,IAAI,EAAE,GAAG,KAAK,SAAS;YACrB;QACF;IACF;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BACb,8OAAC;0BAAG;;;;;;YACH,uBAAS,8OAAC;gBAAE,WAAU;0BAAS;;;;;;0BAChC,8OAAC;gBACC,MAAK;gBACL,aAAY;gBACZ,OAAO;gBACP,UAAU,CAAC,IAAM,SAAS,EAAE,MAAM,CAAC,KAAK;gBACxC,WAAW;;;;;;0BAEb,8OAAC;gBACC,MAAK;gBACL,aAAY;gBACZ,OAAO;gBACP,UAAU,CAAC,IAAM,YAAY,EAAE,MAAM,CAAC,KAAK;gBAC3C,WAAW;;;;;;0BAEb,8OAAC;gBAAO,SAAS;0BAAa;;;;;;;;;;;;AAGpC","debugId":null}},
    {"offset": {"line": 2172, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}},
    {"offset": {"line": 2178, "column": 0}, "map": {"version":3,"sources":["file://C%3A/Users/hiros/OneDrive%20-%20%E6%88%90%E7%94%B0%E5%BC%98/Tech0/VS%20Code/Git_Clone_calendar_app/Calendar_app2/src/app/page.tsx"],"sourcesContent":["\"use client\";\r\n\r\nimport { useState, useEffect } from \"react\";\r\nimport Sidebar, { SidebarView } from \"@/components/Sidebar\";\r\nimport BudgetReportPage from \"@/app/budget-report/page\";\r\nimport UserReportPage from \"@/app/user-report/page\";\r\nimport UserMonthlyDashboard from \"@/app/user-monthly-dashboard/page\";\r\nimport BudgetManagement from \"@/components/BudgetManagement\";\r\nimport Login from \"@/app/login/page\"; // ← これを使う（または components/Login.tsx）\r\n\r\nexport default function HomePage() {\r\n  const [view, setView] = useState<SidebarView>(\"calendar\");\r\n  const [isAuthenticated, setIsAuthenticated] = useState<boolean | null>(null);\r\n\r\n  useEffect(() => {\r\n    const auth = localStorage.getItem(\"isAuthenticated\");\r\n    setIsAuthenticated(auth === \"true\"); // ← \"true\" という文字列で保存されてる前提\r\n  }, []);\r\n\r\n  if (isAuthenticated === null) {\r\n    return <div className=\"p-6\">認証確認中...</div>;\r\n  }\r\n\r\n  if (!isAuthenticated) {\r\n    return <Login />; // ✅ 未ログインならログインページを表示\r\n  }\r\n\r\n  return (\r\n    <div className=\"flex min-h-screen\">\r\n      {/* Sidebar */}\r\n      <div className=\"w-64 bg-gray-100 border-r\">\r\n        <Sidebar onSelectView={setView} />\r\n      </div>\r\n\r\n      {/* Main Content */}\r\n      <div className=\"flex-1 bg-white p-6 overflow-auto\">\r\n        \r\n        {view === \"report\" && <BudgetReportPage />}\r\n        {view === \"user-report\" && <UserReportPage />}\r\n        {view === \"dashboard\" && <UserMonthlyDashboard />}\r\n        {view === \"budget\" && <BudgetManagement />}\r\n      </div>\r\n    </div>\r\n  );\r\n}\r\n"],"names":[],"mappings":";;;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,uNAAsC,oCAAoC;AAR1E;;;;;;;;;AAUe,SAAS;IACtB,MAAM,CAAC,MAAM,QAAQ,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAe;IAC9C,MAAM,CAAC,iBAAiB,mBAAmB,GAAG,CAAA,GAAA,qMAAA,CAAA,WAAQ,AAAD,EAAkB;IAEvE,CAAA,GAAA,qMAAA,CAAA,YAAS,AAAD,EAAE;QACR,MAAM,OAAO,aAAa,OAAO,CAAC;QAClC,mBAAmB,SAAS,SAAS,2BAA2B;IAClE,GAAG,EAAE;IAEL,IAAI,oBAAoB,MAAM;QAC5B,qBAAO,8OAAC;YAAI,WAAU;sBAAM;;;;;;IAC9B;IAEA,IAAI,CAAC,iBAAiB;QACpB,qBAAO,8OAAC,4HAAA,CAAA,UAAK;;;;kBAAK,sBAAsB;IAC1C;IAEA,qBACE,8OAAC;QAAI,WAAU;;0BAEb,8OAAC;gBAAI,WAAU;0BACb,cAAA,8OAAC,6HAAA,CAAA,UAAO;oBAAC,cAAc;;;;;;;;;;;0BAIzB,8OAAC;gBAAI,WAAU;;oBAEZ,SAAS,0BAAY,8OAAC,uIAAA,CAAA,UAAgB;;;;;oBACtC,SAAS,+BAAiB,8OAAC,qIAAA,CAAA,UAAc;;;;;oBACzC,SAAS,6BAAe,8OAAC,mJAAA,CAAA,UAAoB;;;;;oBAC7C,SAAS,0BAAY,8OAAC,sIAAA,CAAA,UAAgB;;;;;;;;;;;;;;;;;AAI/C","debugId":null}},
    {"offset": {"line": 2275, "column": 0}, "map": {"version":3,"sources":[],"names":[],"mappings":"A"}}]
}